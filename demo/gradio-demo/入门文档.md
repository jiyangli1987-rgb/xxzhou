# å¦‚ä½•ä½¿ç”¨ Gradio åˆ›å»ºèŠå¤©æœºå™¨äºº

## ç®€ä»‹

èŠå¤©æœºå™¨äººæ˜¯å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„çƒ­é—¨åº”ç”¨åœºæ™¯ã€‚å€ŸåŠ© Gradioï¼Œä½ å¯ä»¥è½»æ¾æ„å»ºèŠå¤©åº”ç”¨å¹¶åˆ†äº«ç»™ç”¨æˆ·ï¼Œæˆ–é€šè¿‡ç›´è§‚çš„ UI è‡ªè¡Œè¯•ç”¨ã€‚

æœ¬æ•™ç¨‹å°†ä½¿ç”¨Â `gr.ChatInterface()`â€”â€” è¿™æ˜¯ä¸€ä¸ªé«˜å±‚æŠ½è±¡ç»„ä»¶ï¼Œè®©ä½ èƒ½ç”¨å‡ è¡Œ Python ä»£ç å¿«é€Ÿåˆ›å»ºèŠå¤©æœºå™¨äºº UIã€‚å®ƒè¿˜å¯çµæ´»é€‚é…å¤šæ¨¡æ€èŠå¤©æœºå™¨äººï¼Œæˆ–æ”¯æŒè¿›ä¸€æ­¥è‡ªå®šä¹‰çš„åœºæ™¯ã€‚

### å‰ç½®æ¡ä»¶

è¯·ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Gradioï¼š

bash

è¿è¡Œ

```bash
$ pip install --upgrade gradio
```

### OpenAI-API å…¼å®¹ç«¯ç‚¹è¯´æ˜

è‹¥ä½ æœ‰æä¾› OpenAI-API å…¼å®¹ç«¯ç‚¹çš„èŠå¤©æœåŠ¡å™¨ï¼ˆå¦‚ Ollamaï¼‰ï¼Œå¯é€šè¿‡ä¸€è¡Œ Python ä»£ç å¯åŠ¨Â `ChatInterface`ã€‚é¦–å…ˆæ‰§è¡ŒÂ `pip install openai`ï¼Œå†ä¼ å…¥è‡ªå®šä¹‰ URLã€æ¨¡å‹å’Œå¯é€‰ä»¤ç‰Œï¼š

python

è¿è¡Œ

```python
import gradio as gr

gr.load_chat("http://localhost:11434/v1/", model="llama3.2", token="***").launch()
```

æŸ¥çœ‹Â [gr.load_chat å®˜æ–¹æ–‡æ¡£](https://gradio.app/docs/gradio/load_chat/)Â äº†è§£æ›´å¤šç»†èŠ‚ã€‚è‹¥ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹ï¼Œè¯·ç»§ç»­é˜…è¯»ä¸‹æ–‡ï¼Œå­¦ä¹ å¦‚ä½•åŸºäºä»»æ„ Python èŠå¤©æ¨¡å‹æ„å»ºåº”ç”¨ï¼

## å®šä¹‰èŠå¤©å‡½æ•°

ä½¿ç”¨Â `gr.ChatInterface()`Â åˆ›å»ºèŠå¤©åº”ç”¨æ—¶ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰èŠå¤©å‡½æ•°ã€‚æœ€ç®€å•çš„åœºæ™¯ä¸‹ï¼Œè¯¥å‡½æ•°éœ€æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆå‚æ•°åå¯è‡ªå®šä¹‰ï¼Œä½†é¡ºåºå¿…é¡»å›ºå®šï¼‰ï¼š

- `message`ï¼šå­—ç¬¦ä¸²ç±»å‹ï¼Œä»£è¡¨ç”¨æˆ·æœ€æ–°å‘é€çš„æ¶ˆæ¯ã€‚
- `history`ï¼šOpenAI é£æ ¼çš„å­—å…¸åˆ—è¡¨ï¼ŒåŒ…å«Â `role`ï¼ˆè§’è‰²ï¼‰å’ŒÂ `content`ï¼ˆå†…å®¹ï¼‰é”®ï¼Œè®°å½•å†å²å¯¹è¯è®°å½•ã€‚ä¹Ÿå¯åŒ…å«é¢å¤–çš„æ¶ˆæ¯å…ƒæ•°æ®é”®ã€‚

### å†å²å¯¹è¯æ ¼å¼ç¤ºä¾‹

python

è¿è¡Œ

```python
[
    {"role": "user", "content": [{"type": "text", "text": "æ³•å›½çš„é¦–éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ"}]},
    {"role": "assistant", "content": [{"type": "text", "text": "å·´é»"}]}
]
```

### ä¸‹ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹

python

è¿è¡Œ

```python
"And what is its largest city?"  # ä¸­æ–‡åœºæ™¯ä¸‹ä¸ºï¼š"é‚£å®ƒæœ€å¤§çš„åŸå¸‚æ˜¯ä»€ä¹ˆï¼Ÿ"
```

### èŠå¤©å‡½æ•°è¿”å›è¦æ±‚

éœ€è¿”å›å­—ç¬¦ä¸²ç±»å‹çš„æœºå™¨äººå“åº”ï¼ˆåŸºäºå†å²å¯¹è¯å’Œæœ€æ–°æ¶ˆæ¯ç”Ÿæˆï¼‰ã€‚ä¾‹å¦‚ä¸Šè¿°åœºæ™¯ä¸­ï¼Œè¿”å›ï¼š

python

è¿è¡Œ

```python
"å·´é»ä¹Ÿæ˜¯æ³•å›½æœ€å¤§çš„åŸå¸‚ã€‚"
```

## èŠå¤©å‡½æ•°ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šéšæœºè¿”å› â€œæ˜¯â€ æˆ– â€œå¦â€ çš„èŠå¤©æœºå™¨äºº

åˆ›å»ºéšæœºå“åº” â€œæ˜¯â€ æˆ– â€œå¦â€ çš„èŠå¤©å‡½æ•°ï¼š

python

è¿è¡Œ

```python
import random

def random_response(message, history):
    return random.choice(["æ˜¯", "å¦"])
```

å°†å‡½æ•°ä¼ å…¥Â `gr.ChatInterface()`Â å¹¶è°ƒç”¨Â `.launch()`Â å¯åŠ¨ Web ç•Œé¢ï¼š

python

è¿è¡Œ

```python
import gradio as gr

gr.ChatInterface(
    fn=random_response,  # ç»‘å®šèŠå¤©å‡½æ•°
).launch()
```

è¿è¡Œåå³å¯è·å¾—å¯äº¤äº’çš„æ¼”ç¤ºç•Œé¢ï¼Œè¾“å…¥æ¶ˆæ¯å³å¯æµ‹è¯•ï¼

> ç•Œé¢æ•ˆæœï¼šåŒ…å«èŠå¤©æœºå™¨äººé¢æ¿ã€æ–‡æœ¬è¾“å…¥æ¡†ï¼ˆæç¤ºæ–‡å­— â€œè¾“å…¥æ¶ˆæ¯...â€ï¼‰ï¼ŒåŸºäº Gradio æ„å»ºï¼Œå¯æ‰˜ç®¡åœ¨ Hugging Face Spacesã€‚

### ç¤ºä¾‹ 2ï¼šäº¤æ›¿åŒæ„ / ä¸åŒæ„çš„èŠå¤©æœºå™¨äºº

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ç»“åˆç”¨æˆ·è¾“å…¥å’Œå†å²å¯¹è¯ç”Ÿæˆå“åº”ï¼š

python

è¿è¡Œ

```python
import gradio as gr

def alternatingly_agree(message, history):
    # ç»Ÿè®¡åŠ©æ‰‹å†å²å“åº”æ¬¡æ•°ï¼Œå¶æ•°æ¬¡åŒæ„ï¼Œå¥‡æ•°æ¬¡ä¸åŒæ„
    assistant_responses = [h for h in history if h['role'] == "assistant"]
    if len(assistant_responses) % 2 == 0:
        return f"æ˜¯çš„ï¼Œæˆ‘è®¤åŒï¼š{message}"
    else:
        return "æˆ‘ä¸è¿™ä¹ˆè®¤ä¸º"

gr.ChatInterface(
    fn=alternatingly_agree,
).launch()
```

æ›´å¤šç»“åˆä¸»æµ LLM çš„çœŸå®åœºæ™¯ç¤ºä¾‹ï¼Œè¯¦è§åç»­æŒ‡å—ã€‚

## æµå¼èŠå¤©æœºå™¨äºº

åœ¨èŠå¤©å‡½æ•°ä¸­ä½¿ç”¨Â `yield`Â å…³é”®å­—å¯ç”Ÿæˆä¸€ç³»åˆ—éƒ¨åˆ†å“åº”ï¼ˆæ¯æ¬¡å“åº”ä¼šæ›¿æ¢ä¸Šä¸€æ¬¡ï¼‰ï¼Œå®ç°æµå¼è¾“å‡ºæ•ˆæœï¼š

python

è¿è¡Œ

```python
import time
import gradio as gr

def slow_echo(message, history):
    for i in range(len(message)):
        time.sleep(0.3)  # æ¨¡æ‹Ÿå»¶è¿Ÿï¼Œé€å­—è¾“å‡º
        yield "ä½ è¾“å…¥äº†ï¼š" + message[: i+1]

gr.ChatInterface(
    fn=slow_echo,
).launch()
```

### æµå¼ç‰¹æ€§è¯´æ˜

- å“åº”æµå¼è¾“å‡ºæ—¶ï¼Œâ€œæäº¤â€ æŒ‰é’®ä¼šå˜ä¸º â€œåœæ­¢â€ æŒ‰é’®ï¼Œå¯ä¸­æ–­ç”Ÿæˆè¿‡ç¨‹ã€‚
- Gradio ä»…å‘å‰ç«¯ä¼ è¾“æ¯æ¬¡å“åº”çš„å·®å¼‚éƒ¨åˆ†ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿå’Œæ•°æ®æ¶ˆè€—ã€‚

## è‡ªå®šä¹‰èŠå¤© UI

`gr.ChatInterface`Â æ”¯æŒå¤šç§è‡ªå®šä¹‰å‚æ•°ï¼ˆä¸Â `gr.Interface`Â å…¼å®¹ï¼‰ï¼Œä¾‹å¦‚ï¼š

- é€šè¿‡Â `title`Â å’ŒÂ `description`Â æ·»åŠ æ ‡é¢˜å’Œæè¿°ã€‚
- åœ¨Â `launch()`Â ä¸­é€šè¿‡Â `theme`Â å’ŒÂ `css`Â é…ç½®ä¸»é¢˜å’Œè‡ªå®šä¹‰æ ·å¼ã€‚
- æ·»åŠ ç¤ºä¾‹æ¶ˆæ¯ï¼ˆ`examples`ï¼‰å¹¶å¯ç”¨ç¼“å­˜ï¼ˆ`cache_examples=True`ï¼‰ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
- è‡ªå®šä¹‰èŠå¤©é¢æ¿ï¼ˆå¦‚é«˜åº¦ã€å ä½æç¤ºï¼‰å’Œæ–‡æœ¬è¾“å…¥æ¡†ï¼ˆå¦‚æœ€å¤§å­—ç¬¦æ•°ã€å ä½æ–‡å­—ï¼‰ã€‚

### è‡ªå®šä¹‰ç¤ºä¾‹ï¼šå®Œæ•´é…ç½®æ¼”ç¤º

python

è¿è¡Œ

```python
import gradio as gr

def yes_man(message, history):
    if message.endswith("ï¼Ÿ"):  # ä¸­æ–‡é—®å·åˆ¤æ–­
        return "æ˜¯"
    else:
        return "å°½ç®¡é—®æˆ‘ä»»ä½•é—®é¢˜ï¼"

gr.ChatInterface(
    yes_man,  # èŠå¤©å‡½æ•°
    chatbot=gr.Chatbot(height=300),  # èŠå¤©é¢æ¿é«˜åº¦ 300px
    textbox=gr.Textbox(
        placeholder="é—®æˆ‘ä¸€ä¸ªæ˜¯/å¦é—®é¢˜",  # è¾“å…¥æ¡†å ä½æç¤º
        container=False,  # ä¸æ˜¾ç¤ºè¾“å…¥æ¡†å®¹å™¨
        scale=7  # è¾“å…¥æ¡†å®½åº¦å æ¯”
    ),
    title="ä¸‡èƒ½åŒæ„æœºå™¨äºº",  # åº”ç”¨æ ‡é¢˜
    description="å‘ä¸‡èƒ½åŒæ„æœºå™¨äººæé—®ä»»ä½•é—®é¢˜",  # åº”ç”¨æè¿°
    examples=["ä½ å¥½", "æˆ‘é…·å—ï¼Ÿ", "è¥¿çº¢æŸ¿æ˜¯è”¬èœå—ï¼Ÿ"],  # ç¤ºä¾‹æ¶ˆæ¯
    cache_examples=True,  # ç¼“å­˜ç¤ºä¾‹å“åº”ï¼ˆå³æ—¶æ˜¾ç¤ºç»“æœï¼‰
).launch(theme="ocean")  # ä½¿ç”¨ "ocean" ä¸»é¢˜
```

### èŠå¤©é¢æ¿å ä½æç¤º

é€šè¿‡Â `gr.Chatbot`Â çš„Â `placeholder`Â å‚æ•°è®¾ç½®èŠå¤©é¢æ¿åˆå§‹æç¤ºï¼ˆæ”¯æŒ Markdown/HTMLï¼‰ï¼š

python

è¿è¡Œ

```python
gr.ChatInterface(
    yes_man,
    chatbot=gr.Chatbot(
        placeholder="<strong>ä½ çš„ä¸“å±åŒæ„æœºå™¨äºº</strong><br>å°½ç®¡å‘æˆ‘æé—®"
    ),
    # å…¶ä»–å‚æ•°...
)
```

å ä½æç¤ºä¼šåœ¨èŠå¤©é¢æ¿ä¸­å‚ç›´å’Œæ°´å¹³å±…ä¸­æ˜¾ç¤ºã€‚

## å¤šæ¨¡æ€èŠå¤©ç•Œé¢

é€šè¿‡Â `multimodal=True`Â å‚æ•°å¯ç”¨å¤šæ¨¡æ€æ”¯æŒï¼Œå…è®¸ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ã€æ–‡ä»¶å¹¶é’ˆå¯¹è¿™äº›å†…å®¹æé—®ï¼š

python

è¿è¡Œ

```python
gr.ChatInterface(
    fn=your_multimodal_function,
    multimodal=True,  # å¯ç”¨å¤šæ¨¡æ€
    textbox=gr.MultimodalTextbox(...)  # å¤šæ¨¡æ€è¾“å…¥æ¡†
)
```

### å¤šæ¨¡æ€å‡½æ•°å‚æ•°å˜åŒ–

å¯ç”¨Â `multimodal=True`Â åï¼ŒèŠå¤©å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆåŸÂ `message`ï¼‰å˜ä¸ºå­—å…¸ç±»å‹ï¼ŒåŒ…å«ï¼š

python

è¿è¡Œ

```python
{
    "text": "ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬",  # å­—ç¬¦ä¸²
    "files": [  # ä¸Šä¼ æ–‡ä»¶è·¯å¾„åˆ—è¡¨
        "æ›´æ–°åçš„æ–‡ä»¶1è·¯å¾„.ext",
        "æ›´æ–°åçš„æ–‡ä»¶2è·¯å¾„.ext",
        ...
    ]
}
```

### å¤šæ¨¡æ€å†å²å¯¹è¯æ ¼å¼

å†å²å¯¹è¯Â `history`Â ä»ä¸º OpenAI é£æ ¼ï¼Œä½†æ–‡ä»¶å†…å®¹ä¼šä»¥Â `type: "file"`Â æ ‡è¯†ï¼š

python

è¿è¡Œ

```python
[
    {
        "role": "user",
        "content": [
            {"type": "file", "file": {"path": "cat1.png"}},  # ç¬¬ä¸€å¼ å›¾ç‰‡
            {"type": "file", "file": {"path": "cat2.png"}},  # ç¬¬äºŒå¼ å›¾ç‰‡
            {"type": "text", "text": "è¿™ä¸¤å¼ å›¾ç‰‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"}  # ç”¨æˆ·é—®é¢˜
        ]
    }
]
```

### å¤šæ¨¡æ€èŠå¤©å‡½æ•°ç¤ºä¾‹

python

è¿è¡Œ

```python
import gradio as gr

def count_images(message, history):
    # ç»Ÿè®¡å½“å‰ä¸Šä¼ çš„å›¾ç‰‡æ•°
    current_images = len(message["files"])
    # ç»Ÿè®¡å†å²å¯¹è¯ä¸­çš„å›¾ç‰‡æ€»æ•°
    total_history_images = 0
    for msg in history:
        for content in msg["content"]:
            if content["type"] == "file":
                total_history_images += 1
    # è¿”å›ç»Ÿè®¡ç»“æœ
    return f"æœ¬æ¬¡ä¸Šä¼  {current_images} å¼ å›¾ç‰‡ï¼Œç´¯è®¡ä¸Šä¼ ï¼š{total_history_images + current_images} å¼ "

demo = gr.ChatInterface(
    fn=count_images,
    examples=[{"text": "æ— æ–‡ä»¶", "files": []}],  # ç¤ºä¾‹ï¼šæ— æ–‡ä»¶ä¸Šä¼ 
    multimodal=True,  # å¯ç”¨å¤šæ¨¡æ€
    textbox=gr.MultimodalTextbox(
        file_count="multiple",  # æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ 
        file_types=["image"],  # ä»…å…è®¸ä¸Šä¼ å›¾ç‰‡
        sources=["upload", "microphone"]  # æ”¯æŒä¸Šä¼ å’Œéº¦å…‹é£è¾“å…¥ï¼ˆéº¦å…‹é£ç”¨äºè¯­éŸ³è½¬æ–‡å­—ï¼‰
    )
)

demo.launch()
```

## é¢å¤–è¾“å…¥ç»„ä»¶

é€šè¿‡Â `additional_inputs`Â å‚æ•°ä¸ºèŠå¤©å‡½æ•°æ·»åŠ é¢å¤–è¾“å…¥ç»„ä»¶ï¼ˆå¦‚ç³»ç»Ÿæç¤ºæ–‡æœ¬æ¡†ã€å“åº”é•¿åº¦æ»‘å—ï¼‰ï¼š

python

è¿è¡Œ

```python
import gradio as gr
import time

def echo(message, history, system_prompt, tokens):
    # ç»“åˆç³»ç»Ÿæç¤ºå’Œç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆå“åº”
    response = f"ç³»ç»Ÿæç¤ºï¼š{system_prompt}\n ç”¨æˆ·æ¶ˆæ¯ï¼š{message}"
    # æŒ‰ tokens é™åˆ¶è¾“å‡ºé•¿åº¦ï¼Œæµå¼è¿”å›
    for i in range(min(len(response), int(tokens))):
        time.sleep(0.05)
        yield response[: i + 1]

demo = gr.ChatInterface(
    echo,
    additional_inputs=[
        gr.Textbox("ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„ AIã€‚", label="ç³»ç»Ÿæç¤º"),  # ç³»ç»Ÿæç¤ºè¾“å…¥æ¡†
        gr.Slider(10, 100, label="å“åº”é•¿åº¦"),  # å“åº”é•¿åº¦æ»‘å—ï¼ˆ10-100 å­—ç¬¦ï¼‰
    ],
)

demo.launch()
```

### è‡ªå®šä¹‰é¢å¤–è¾“å…¥ç»„ä»¶å¸ƒå±€

è‹¥éœ€è‡ªå®šä¹‰é¢å¤–è¾“å…¥ç»„ä»¶çš„ä½ç½®ï¼Œå¯ç»“åˆÂ `gr.Blocks()`Â å®ç°ï¼š

python

è¿è¡Œ

```python
import gradio as gr
import time

def echo(message, history, system_prompt, tokens):
    response = f"ç³»ç»Ÿæç¤ºï¼š{system_prompt}\n ç”¨æˆ·æ¶ˆæ¯ï¼š{message}"
    for i in range(min(len(response), int(tokens))):
        time.sleep(0.05)
        yield response[: i+1]

with gr.Blocks() as demo:
    # ç³»ç»Ÿæç¤ºæ¡†æ”¾åœ¨èŠå¤©ç•Œé¢ä¸Šæ–¹
    system_prompt = gr.Textbox("ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„ AIã€‚", label="ç³»ç»Ÿæç¤º")
    # æ»‘å—é»˜è®¤ä¸æ¸²æŸ“ï¼Œåç»­ä¼ å…¥ ChatInterface
    slider = gr.Slider(10, 100, label="å“åº”é•¿åº¦", render=False)

    gr.ChatInterface(
        echo,
        additional_inputs=[system_prompt, slider],  # ç»‘å®šé¢å¤–è¾“å…¥ç»„ä»¶
    )

demo.launch()
```

### é¢å¤–è¾“å…¥ç»„ä»¶çš„ç¤ºä¾‹é…ç½®

é€šè¿‡Â `examples`Â å‚æ•°ä¸ºé¢å¤–è¾“å…¥ç»„ä»¶æä¾›ç¤ºä¾‹å€¼ï¼ˆæ ¼å¼ä¸ºåˆ—è¡¨åµŒå¥—åˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºèŠå¤©æ¶ˆæ¯ï¼Œåç»­ä¸ºé¢å¤–è¾“å…¥çš„ç¤ºä¾‹å€¼ï¼‰ï¼š

python

è¿è¡Œ

```python
gr.ChatInterface(
    echo,
    additional_inputs=[
        gr.Textbox(label="ç³»ç»Ÿæç¤º"),
        gr.Slider(10, 100, label="å“åº”é•¿åº¦"),
    ],
    examples=[
        ["ä½ å¥½", "ä½ æ˜¯å‹å¥½çš„ AI", 50],  # æ¶ˆæ¯ï¼š"ä½ å¥½"ï¼Œç³»ç»Ÿæç¤ºï¼š"ä½ æ˜¯å‹å¥½çš„ AI"ï¼Œå“åº”é•¿åº¦ï¼š50
        ["ä»‹ç»è‡ªå·±", "ç®€æ´ä»‹ç»è‡ªå·±", 30],  # æ¶ˆæ¯ï¼š"ä»‹ç»è‡ªå·±"ï¼Œç³»ç»Ÿæç¤ºï¼š"ç®€æ´ä»‹ç»è‡ªå·±"ï¼Œå“åº”é•¿åº¦ï¼š30
    ],
)
```

ç¤ºä¾‹ä¼šä»¥è¡¨æ ¼å½¢å¼æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ä¸‹æ–¹ã€‚

## é¢å¤–è¾“å‡ºç»„ä»¶

é€šè¿‡Â `additional_outputs`Â å‚æ•°æ·»åŠ é¢å¤–è¾“å‡ºç»„ä»¶ï¼ˆå¦‚ä»£ç å±•ç¤ºæ¡†ï¼‰ï¼ŒèŠå¤©å‡½æ•°éœ€è¿”å›å¯¹åº”æ•°é‡çš„è¾“å‡ºå€¼ï¼š

python

è¿è¡Œ

```python
import gradio as gr

# ç¤ºä¾‹ä»£ç 
python_code = """
def fib(n):
    if n <= 0:
        return 0
    elif n == 1:
        return 1
    else:
        return fib(n-1) + fib(n-2)
"""

js_code = """
function fib(n) {
    if (n <= 0) return 0;
    if (n === 1) return 1;
    return fib(n - 1) + fib(n - 2);
}
"""

def chat(message, history):
    if "python" in message.lower():
        # è¿”å›èŠå¤©å“åº”å’Œ Python ä»£ç 
        return "è¾“å…¥ Python æˆ– JavaScript æŸ¥çœ‹å¯¹åº”ä»£ç ã€‚", gr.Code(language="python", value=python_code)
    elif "javascript" in message.lower():
        # è¿”å›èŠå¤©å“åº”å’Œ JavaScript ä»£ç 
        return "è¾“å…¥ Python æˆ– JavaScript æŸ¥çœ‹å¯¹åº”ä»£ç ã€‚", gr.Code(language="javascript", value=js_code)
    else:
        # æ— é¢å¤–è¾“å‡ºæ—¶è¿”å› None
        return "è¯·è¯¢é—® Python æˆ– JavaScript ç›¸å…³é—®é¢˜ã€‚", None

with gr.Blocks() as demo:
    # å®šä¹‰ä»£ç è¾“å‡ºç»„ä»¶ï¼ˆåˆå§‹ä¸æ¸²æŸ“ï¼‰
    code = gr.Code(render=False)
    with gr.Row():  # æ¨ªå‘å¸ƒå±€
        with gr.Column():  # å·¦ä¾§åˆ—ï¼šèŠå¤©ç•Œé¢
            gr.Markdown("<center><h1>è¾“å…¥ Python æˆ– JavaScript</h1></center>")
            gr.ChatInterface(
                chat,
                examples=["Python", "JavaScript"],
                additional_outputs=[code],  # ç»‘å®šé¢å¤–è¾“å‡ºç»„ä»¶
                api_name="chat",
            )
        with gr.Column():  # å³ä¾§åˆ—ï¼šä»£ç å±•ç¤º
            gr.Markdown("<center><h1>ä»£ç å±•ç¤º</h1></center>")
            code.render()  # æ¸²æŸ“ä»£ç ç»„ä»¶

demo.launch()
```

### æ³¨æ„äº‹é¡¹

é¢å¤–è¾“å‡ºç»„ä»¶å¿…é¡»åœ¨Â `gr.Blocks()`Â ä¸Šä¸‹æ–‡å…ˆå®šä¹‰ï¼Œä¸”åˆå§‹éœ€è®¾ç½®Â `render=False`ï¼Œåç»­åœ¨æŒ‡å®šä½ç½®è°ƒç”¨Â `.render()`Â æ¸²æŸ“ã€‚

## å¤æ‚å“åº”è¿”å›

### 1. è¿”å›æ–‡ä»¶æˆ– Gradio ç»„ä»¶

ä»¥ä¸‹ Gradio ç»„ä»¶å¯ç›´æ¥åœ¨èŠå¤©ç•Œé¢ä¸­æ˜¾ç¤ºï¼š

- `gr.Image`ï¼ˆå›¾ç‰‡ï¼‰
- `gr.Plot`ï¼ˆå›¾è¡¨ï¼‰
- `gr.Audio`ï¼ˆéŸ³é¢‘ï¼‰
- `gr.HTML`ï¼ˆHTML å†…å®¹ï¼‰
- `gr.Video`ï¼ˆè§†é¢‘ï¼‰
- `gr.Gallery`ï¼ˆå›¾ç‰‡ç”»å»Šï¼‰
- `gr.File`ï¼ˆæ–‡ä»¶ï¼‰

#### ç¤ºä¾‹ï¼šè¿”å›éŸ³é¢‘æ–‡ä»¶

python

è¿è¡Œ

```python
import gradio as gr

def music(message, history):
    if message.strip():
        # è¿”å›éŸ³é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒæœ¬åœ°è·¯å¾„æˆ– URLï¼‰
        return gr.Audio("https://github.com/gradio-app/gradio/raw/main/test/test_files/audio_sample.wav")
    else:
        return "è¯·è¾“å…¥è‰ºæœ¯å®¶åç§°"

gr.ChatInterface(
    music,
    textbox=gr.Textbox(placeholder="ä½ æƒ³å¬å“ªä½è‰ºæœ¯å®¶çš„éŸ³ä¹ï¼Ÿ", scale=7),
).launch()
```

### 2. è¿”å›å¤šæ¡æ¶ˆæ¯

é€šè¿‡è¿”å›æ¶ˆæ¯åˆ—è¡¨ï¼Œå¯åŒæ—¶å‘é€å¤šæ¡åŠ©æ‰‹å“åº”ï¼ˆæ”¯æŒæ–‡æœ¬ + æ–‡ä»¶ç»„åˆï¼‰ï¼š

python

è¿è¡Œ

```python
import gradio as gr

def echo_multimodal(message, history):
    response = []
    # æ·»åŠ æ–‡æœ¬å“åº”
    response.append(f"ä½ è¾“å…¥äº†ï¼š'{message['text']}'ï¼Œå¹¶ä¸Šä¼ äº†ä»¥ä¸‹æ–‡ä»¶ï¼š")
    # æ·»åŠ ä¸Šä¼ çš„æ–‡ä»¶
    if message.get("files"):
        for file in message["files"]:
            response.append(gr.File(value=file))  # æ˜¾ç¤ºæ¯ä¸ªä¸Šä¼ çš„æ–‡ä»¶
    return response

demo = gr.ChatInterface(
    echo_multimodal,
    multimodal=True,
    textbox=gr.MultimodalTextbox(file_count="multiple"),  # æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ 
    api_name="chat",
)

demo.launch()
```

### 3. æ˜¾ç¤ºä¸­é—´æ€è€ƒè¿‡ç¨‹æˆ–å·¥å…·è°ƒç”¨

é€šè¿‡è¿”å›Â `gr.ChatMessage`Â å¯¹è±¡ï¼Œå¯åœ¨èŠå¤©ç•Œé¢ä¸­æ˜¾ç¤ºä¸­é—´æ€è€ƒè¿‡ç¨‹æˆ–å·¥å…·è°ƒç”¨è®°å½•ï¼š

#### `gr.ChatMessage`Â æ•°æ®ç»“æ„

python

è¿è¡Œ

```python
from dataclasses import dataclass
from typing import Union, List, Dict, Optional, Literal

# æ¶ˆæ¯å†…å®¹ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ–‡ä»¶æ•°æ®ã€ç»„ä»¶å®ä¾‹
MessageContent = Union[str, Dict, gr.Component]

@dataclass
class ChatMessage:
    content: MessageContent | List[MessageContent]  # æ¶ˆæ¯å†…å®¹
    metadata: Optional[Dict] = None  # å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€IDã€çŠ¶æ€ç­‰ï¼‰
    options: Optional[List[Dict]] = None  # é¢„è®¾å“åº”é€‰é¡¹

# å…ƒæ•°æ®å­—å…¸ç»“æ„
MetadataDict = Dict[Literal["title", "id", "parent_id", "log", "duration", "status"], Union[str, int, float]]
# é¢„è®¾é€‰é¡¹å­—å…¸ç»“æ„
OptionDict = Dict[Literal["label", "value"], str]
```

#### ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿæ€è€ƒè¿‡ç¨‹çš„æµå¼å“åº”

python

è¿è¡Œ

```python
import gradio as gr
from gradio import ChatMessage
import time

sleep_time = 0.5  # æ¯æ­¥æ€è€ƒçš„å»¶è¿Ÿæ—¶é—´

def simulate_thinking_chat(message, history):
    start_time = time.time()
    # åˆå§‹åŒ–æ€è€ƒè¿‡ç¨‹æ¶ˆæ¯ï¼ˆçŠ¶æ€ä¸º"pending"ï¼‰
    thinking_msg = ChatMessage(
        content="",
        metadata={
            "title": "_æ€è€ƒä¸­_ é€æ­¥åˆ†æ...",  # ä¸­é—´è¿‡ç¨‹æ ‡é¢˜
            "id": 0,
            "status": "pending"  # çŠ¶æ€ï¼šå¾…å®Œæˆ
        }
    )
    yield thinking_msg

    # æ¨¡æ‹Ÿæ€è€ƒæ­¥éª¤
    thoughts = [
        "é¦–å…ˆï¼Œæˆ‘éœ€è¦ç†è§£ç”¨æˆ·æŸ¥è¯¢çš„æ ¸å¿ƒéœ€æ±‚...",
        "æ¥ä¸‹æ¥ï¼Œç»“åˆä¸Šä¸‹æ–‡åˆ†æå¯èƒ½çš„å›ç­”æ–¹å‘...",
        "ç„¶åï¼Œæ¢³ç†å…³é”®ä¿¡æ¯å¹¶ç»„ç»‡å›ç­”ç»“æ„...",
        "æœ€åï¼Œç¡®ä¿å›ç­”æ¸…æ™°ã€å‡†ç¡®ä¸”å®Œæ•´..."
    ]

    accumulated_thoughts = ""
    for thought in thoughts:
        time.sleep(sleep_time)
        accumulated_thoughts += f"- {thought}\n\n"
        thinking_msg.content = accumulated_thoughts.strip()
        yield thinking_msg  # æµå¼æ›´æ–°æ€è€ƒè¿‡ç¨‹

    # æ›´æ–°æ€è€ƒå®ŒæˆçŠ¶æ€å’Œè€—æ—¶
    thinking_msg.metadata["status"] = "done"  # çŠ¶æ€ï¼šå·²å®Œæˆ
    thinking_msg.metadata["duration"] = round(time.time() - start_time, 2)  # è€—æ—¶
    yield thinking_msg

    # å‘é€æœ€ç»ˆå›ç­”
    final_response = ChatMessage(
        content="åŸºäºä»¥ä¸Šæ€è€ƒåˆ†æï¼Œæˆ‘çš„æœ€ç»ˆå›ç­”æ˜¯ï¼šæœ¬ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨è¿”å›æœ€ç»ˆç­”æ¡ˆå‰ï¼Œé€æ­¥æ˜¾ç¤º LLM çš„æ€è€ƒè¿‡ç¨‹ã€‚"
    )
    yield [thinking_msg, final_response]  # åŒæ—¶è¿”å›æ€è€ƒè¿‡ç¨‹å’Œæœ€ç»ˆç­”æ¡ˆ

demo = gr.ChatInterface(
    simulate_thinking_chat,
    title="å¸¦æ€è€ƒè¿‡ç¨‹çš„ LLM èŠå¤©ç•Œé¢ ğŸ¤”",
)

demo.launch()
```

#### åµŒå¥—æ€è€ƒè¿‡ç¨‹ï¼ˆå·¥å…·åµŒå¥—è°ƒç”¨ï¼‰

é€šè¿‡åœ¨Â `metadata`Â ä¸­è®¾ç½®Â `id`Â å’ŒÂ `parent_id`ï¼Œå¯å®ç°åµŒå¥—æ€è€ƒè¿‡ç¨‹ï¼ˆé€‚ç”¨äºå·¥å…·è°ƒç”¨é“¾åœºæ™¯ï¼‰ï¼Œè¯¦è§Â [å®˜æ–¹æŒ‡å—](https://gradio.app/docs/gradio/chatinterface/#displaying-intermediate-thoughts-or-tool-usage)ã€‚

### 4. æä¾›é¢„è®¾å“åº”é€‰é¡¹

é€šè¿‡Â `gr.ChatMessage`Â çš„Â `options`Â å‚æ•°ï¼Œå¯ä¸ºåŠ©æ‰‹å“åº”æ·»åŠ é¢„è®¾å›å¤é€‰é¡¹ï¼ˆç”¨æˆ·ç‚¹å‡»å³å¯å‘é€ï¼‰ï¼š

python

è¿è¡Œ

```python
import gradio as gr
import random

# ç¤ºä¾‹ä»£ç æ¨¡æ¿
example_code = """
ä»¥ä¸‹æ˜¯ Python  lambda å‡½æ•°ç¤ºä¾‹ï¼š

lambda x: x + {}

è¿™æ˜¯å¦æ­£ç¡®ï¼Ÿ
"""

def chat(message, history):
    if message == "æ˜¯çš„ï¼Œè¿™æ˜¯æ­£ç¡®çš„ã€‚":
        return "å¤ªæ£’äº†ï¼"
    else:
        # è¿”å›å¸¦é¢„è®¾é€‰é¡¹çš„å“åº”
        return gr.ChatMessage(
            content=example_code.format(random.randint(1, 100)),  # éšæœºå¡«å……æ•°å­—
            options=[
                {"value": "æ˜¯çš„ï¼Œè¿™æ˜¯æ­£ç¡®çš„ã€‚", "label": "æ­£ç¡®"},  # æ˜¾ç¤ºæ ‡ç­¾"æ­£ç¡®"ï¼Œå®é™…å‘é€å€¼ä¸ºå®Œæ•´æ–‡æœ¬
                {"value": "ä¸æ­£ç¡®"}  # æ— æ ‡ç­¾æ—¶ï¼Œæ˜¾ç¤ºå€¼æœ¬èº«
            ]
        )

demo = gr.ChatInterface(
    chat,
    examples=["å†™ä¸€ä¸ª Python lambda å‡½æ•°ç¤ºä¾‹ã€‚"],
    api_name="chat",
)

demo.launch()
```

## ç›´æ¥ä¿®æ”¹èŠå¤©æœºå™¨äººå€¼

é€šè¿‡Â `gr.ChatInterface.chatbot_value`Â å¯ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼Œç›´æ¥ä¿®æ”¹èŠå¤©é¢æ¿å†…å®¹ï¼ˆå¦‚é¢„å¡«å……å†å²å¯¹è¯ã€æ¸…ç©ºèŠå¤©è®°å½•ï¼‰ï¼š

python

è¿è¡Œ

```python
import gradio as gr

def prefill_chatbot(choice):
    # æ ¹æ®é€‰æ‹©é¢„å¡«å……ä¸åŒçš„å¯¹è¯å†å²
    if choice == "é—®å€™":
        return [
            {"role": "user", "content": "ä½ å¥½ï¼"},
            {"role": "assistant", "content": "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}
        ]
    elif choice == "æŠ•è¯‰":
        return [
            {"role": "user", "content": "æˆ‘å¯¹æœåŠ¡ä¸æ»¡æ„ã€‚"},
            {"role": "assistant", "content": "å¾ˆæŠ±æ­‰ç»™ä½ å¸¦æ¥ä¸å¥½çš„ä½“éªŒã€‚èƒ½è¯¦ç»†è¯´è¯´å…·ä½“é—®é¢˜å—ï¼Ÿ"}
        ]
    else:
        return []  # æ¸…ç©ºèŠå¤©è®°å½•

def random_response(message, history):
    return random.choice(["æ˜¯", "å¦"])

with gr.Blocks() as demo:
    # å•é€‰æ¡†ï¼šé€‰æ‹©é¢„å¡«å……çš„å¯¹è¯ç±»å‹
    radio = gr.Radio(["é—®å€™", "æŠ•è¯‰", "æ¸…ç©º"], label="é¢„å¡«å……å¯¹è¯")
    # åˆ›å»ºèŠå¤©ç•Œé¢
    chat = gr.ChatInterface(random_response, api_name="chat")
    # ç»‘å®šå•é€‰æ¡†å˜åŒ–äº‹ä»¶ï¼šä¿®æ”¹èŠå¤©é¢æ¿å†…å®¹
    radio.change(prefill_chatbot, inputs=radio, outputs=chat.chatbot_value)

demo.launch()
```

## é€šè¿‡ API è°ƒç”¨èŠå¤©æœºå™¨äºº

å°† Gradio èŠå¤©ç•Œé¢éƒ¨ç½²åˆ° Hugging Face Spaces æˆ–å…¶ä»–å¹³å°åï¼Œå¯é€šè¿‡ API è°ƒç”¨ã€‚API è·¯ç”±ä¸ºèŠå¤©å‡½æ•°åï¼ˆå¦‚Â `gr.ChatInterface(respond)`Â å¯¹åº”çš„è·¯ç”±ä¸ºÂ `/respond`ï¼‰ï¼Œæ”¯æŒä¼ å…¥ç”¨æˆ·æ¶ˆæ¯å¹¶è¿”å›å“åº”ï¼ˆè‡ªåŠ¨ç»´æŠ¤å¯¹è¯å†å²ï¼‰ã€‚

### è°ƒç”¨æ–¹å¼

1. ä½¿ç”¨ Gradio Python å®¢æˆ·ç«¯æˆ– JavaScript å®¢æˆ·ç«¯ã€‚
2. éƒ¨ç½²ä¸ºå…¶ä»–å¹³å°åº”ç”¨ï¼š
    - [Slack æœºå™¨äºº](https://gradio.app/tutorials/slack-bot/)
    - [ç½‘ç«™æ’ä»¶](https://gradio.app/tutorials/website-widget/)

## èŠå¤©å†å²è®°å½•

é€šè¿‡Â `save_history=True`Â å¯ç”¨æŒä¹…åŒ–èŠå¤©å†å²ï¼Œç”¨æˆ·å¯ç»´æŠ¤å¤šä¸ªå¯¹è¯å¹¶åˆ‡æ¢ï¼š

python

è¿è¡Œ

```python
gr.ChatInterface(
    fn=your_chat_function,
    save_history=True  # å¯ç”¨èŠå¤©å†å²è®°å½•
)
```

### ç‰¹æ€§è¯´æ˜

- å¯¹è¯å†å²å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œéšç§å®‰å…¨ã€‚
- å¤šç”¨æˆ·åŒæ—¶ä½¿ç”¨æ—¶ï¼Œå„è‡ªçš„å¯¹è¯å†å²äº’ä¸å¹²æ‰°ã€‚
- ç”¨æˆ·å¯åœ¨ä¾§è¾¹æ æŸ¥çœ‹å†å²å¯¹è¯ï¼Œç»§ç»­ä¹‹å‰çš„èŠå¤©æˆ–å¼€å§‹æ–°å¯¹è¯ã€‚

## æ”¶é›†ç”¨æˆ·åé¦ˆ

é€šè¿‡Â `flagging_mode="manual"`Â å¯ç”¨ç”¨æˆ·åé¦ˆåŠŸèƒ½ï¼Œç”¨æˆ·å¯å¯¹åŠ©æ‰‹å“åº”è¿›è¡Œ â€œç‚¹èµâ€ æˆ– â€œç‚¹è¸©â€ï¼š

python

è¿è¡Œ

```python
import time
import gradio as gr

def slow_echo(message, history):
    for i in range(len(message)):
        time.sleep(0.05)
        yield "ä½ è¾“å…¥äº†ï¼š" + message[: i + 1]

demo = gr.ChatInterface(
    slow_echo,
    flagging_mode="manual",  # æ‰‹åŠ¨åé¦ˆæ¨¡å¼
    flagging_options=["ç‚¹èµ", "åƒåœ¾ä¿¡æ¯", "ä¸å½“å†…å®¹", "å…¶ä»–"],  # åé¦ˆé€‰é¡¹
    save_history=True,  # åŒæ—¶å¯ç”¨èŠå¤©å†å²
    flagging_dir="feedback"  # åé¦ˆæ•°æ®å­˜å‚¨ç›®å½•ï¼ˆé»˜è®¤å½“å‰ç›®å½•ï¼‰
)

demo.launch()
```

### åé¦ˆåŠŸèƒ½è¯´æ˜

- åé¦ˆæ•°æ®ï¼ˆå«å®Œæ•´å¯¹è¯å†å²ï¼‰ä¼šä¿å­˜ä¸º CSV æ–‡ä»¶ï¼Œå­˜å‚¨åœ¨Â `flagging_dir`Â æŒ‡å®šç›®å½•ã€‚
- è‹¥åé¦ˆé€‰é¡¹åŒ…å« â€œç‚¹èµâ€ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰ï¼Œä¼šæ˜¾ç¤ºä¸º thumbs-up å›¾æ ‡ï¼›å…¶ä»–é€‰é¡¹æ˜¾ç¤ºåœ¨ â€œæ ‡è®°â€ å›¾æ ‡ä¸‹æ‹‰èœå•ä¸­ã€‚

## åç»­å­¦ä¹ è·¯å¾„

1. **ç»“åˆ LLM çš„èŠå¤©æœºå™¨äºº**ï¼šå­¦ä¹ å¦‚ä½•å°†Â `gr.ChatInterface`Â ä¸ OpenAIã€LlamaCpp ç­‰ä¸»æµ LLM åº“é›†æˆã€‚
2. **è‡ªå®šä¹‰èŠå¤©åº”ç”¨**ï¼šä½¿ç”¨åº•å±‚Â `gr.Blocks()`Â API æ„å»ºå®Œå…¨è‡ªå®šä¹‰çš„èŠå¤©ç•Œé¢ï¼ˆå¦‚å¤šè½®å·¥å…·è°ƒç”¨ã€å¤æ‚å¸ƒå±€ï¼‰ã€‚
3. **éƒ¨ç½²ä¸æ‰©å±•**ï¼šå°† Gradio èŠå¤©ç•Œé¢éƒ¨ç½²ä¸º Discord æœºå™¨äººã€å¾®ä¿¡å°ç¨‹åºç­‰ï¼Œè¯¦è§Â [å®˜æ–¹æ•™ç¨‹](https://gradio.app/tutorials/discord-bot/)ã€‚

ç¼–è¾‘åˆ†äº«

å¦‚ä½•ä½¿ç”¨ Gradio åˆ›å»ºå¤šæ¨¡æ€èŠå¤©æœºå™¨äººï¼Ÿ

æœ‰å“ªäº›å…¶ä»–æ–¹æ³•å¯ä»¥åˆ›å»ºèŠå¤©æœºå™¨äººï¼Ÿ

åˆ†äº«ä¸€ä¸‹ä½ çŸ¥é“çš„å…³äºå¤§å‹è¯­è¨€æ¨¡å‹çš„åº”ç”¨æ¡ˆä¾‹