name: Release

on:
  push:
    tags:
      - 'v*.*.*'  # 匹配 v1.0.0, v1.2.3 等格式的tag

jobs:
  build-and-release:
    runs-on: windows-latest  # 使用Windows环境，因为你的项目是打包成exe

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'  # 根据你的README，使用3.13版本

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller

    - name: Build executable
      run: |
        pyinstaller --clean xxzhou.spec

    - name: Get version from tag
      id: get_version
      shell: bash
      run: |
        # 从tag中提取版本号（去掉v前缀）
        VERSION=${GITHUB_REF#refs/tags/v}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "tag=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ steps.get_version.outputs.tag }}
        name: Release ${{ steps.get_version.outputs.tag }}
        body: |
          ## 自动发布版本 ${{ steps.get_version.outputs.tag }}

          ### 更新内容
          - 请查看提交历史了解详细更新内容

          ### 安装说明
          1. 下载 `xxzhou.exe` 文件
          2. 将exe文件放置在合适位置
          3. 配置环境变量或直接运行

          ### 系统要求
          - Windows 操作系统
          - Python 3.13+ (如果需要源码运行)

          ### 功能特性
          - PDF文档智能识别
          - 图片内容识别和处理
          - 视频下载功能
          - 智能对话助手
        draft: false
        prerelease: false
        files: ./dist/xxzhou.exe
